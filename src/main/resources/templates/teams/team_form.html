<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title th:text="${team.id != null ? 'Edit Team' : 'Create Team'} + ' - Project Management System'">Team Form</title>
    <link rel="stylesheet" th:href="@{/css/style.min.css}">
    <link rel="stylesheet" th:href="@{/css/style.enhancements.css}">
</head>
<body>
    <header th:replace="~{fragments/navbar :: navbar}"></header>
    <main class="container">
        <section class="page-header">
            <h1 th:if="${team.id == null}">üÜï Create New Team</h1>
            <h1 th:if="${team.id != null}">‚úèÔ∏è Edit Team</h1>
        </section>

        <div class="form-container">
            <div class="form-card">
                <div th:if="${errors}" class="alert alert-error">
                    <div th:each="error : ${errors}">
                        <p style="margin: 5px 0;" th:text="${error}">Error message</p>
                    </div>
                </div>

                <form th:action="${team.id != null} ? @{/teams/{id}(id=${team.id})} : @{/teams}" method="post" th:object="${team}">
                    <input type="hidden" th:if="${team.id != null}" th:field="*{id}" />
                    <div class="form-group">
                        <label for="name">Team Name <span class="required">*</span></label>
                        <input type="text" id="name" name="name" th:value="*{name}" required maxlength="100" placeholder="Enter team name" class="form-input">
                        <div class="help-text">Choose a descriptive name for your team (max 100 characters)</div>
                    </div>

                    <div class="form-group">
                        <label for="description">Description</label>
                        <textarea id="description" name="description" th:value="*{description}" placeholder="Enter team description (optional)" class="form-textarea"></textarea>
                        <div class="help-text">Describe the purpose and goals of this team</div>
                    </div>

                    <div class="form-group">
                        <label for="teamLeadId">Team Lead <span class="required">*</span></label>
                        <select id="teamLeadId" name="teamLeadId" required class="form-select">
                            <option value="">Select team lead...</option>
                            <option th:each="user : ${users}" th:value="${user.id}" th:selected="${team.teamLead != null && team.teamLead.id == user.id}" th:text="${user.username + ' (' + user.email + ')'}">User</option>
                        </select>
                        <div class="help-text">Select the person who will lead this team</div>
                    </div>

                    <div class="form-group">
                        <label for="memberIds">Team Members <span class="required">*</span></label>
                        <div style="position: relative;">
                            <select id="memberIds" name="memberIds" multiple size="8" required class="form-select member-select">
                                <option th:each="user : ${users}"
                                        th:value="${user.id}"
                                        th:selected="${team.members != null and #lists.contains(team.members, user)}"
                                        th:classappend="${team.teamLead != null && team.teamLead.id == user.id} ? 'team-lead-option' : ''"
                                        th:text="${user.username + ' (' + user.email + ')'}">User</option>
                            </select>
                            <span class="member-select-indicator">‚áÖ</span>
                        </div>
                        <div class="help-text">
                            <b>Tip:</b> Hold <kbd>Ctrl</kbd> (Windows) or <kbd>Cmd</kbd> (Mac) to select multiple members.<br>
                            <span class="highlight">Team lead will be automatically included as a member.</span>
                        </div>
                        <div th:if="${memberError != null}" class="alert alert-error" th:text="${memberError}"></div>
                    </div>
                    

                    <div class="form-actions">
                        <button type="submit" class="btn-submit" th:text="${team.id == null ? '‚ú® Create Team' : 'üíæ Update Team'}">Submit</button>
                        <a th:href="@{/teams}" class="btn-cancel">‚Üê Cancel</a>
                    </div>
                </form>
            </div>
        </div>
    </main>

    <footer>
        <p>&copy; 2025 Project Management System. All rights reserved.</p>
    </footer>
</body>
</html>
