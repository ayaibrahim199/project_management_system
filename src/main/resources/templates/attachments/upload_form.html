<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Upload Attachment</title>
    <link rel="stylesheet" th:href="@{/css/style.min.css}">
</head>
<body>
    <div class="upload-container">
        <h1>üìÅ Upload Attachment</h1>
        
        <div class="task-info">
            <p><strong>Task:</strong> <span th:text="${task.description}"></span></p>
            <p><strong>Project:</strong> <span th:text="${task.project != null ? task.project.title : 'N/A'}"></span></p>
            <p><strong>Status:</strong> <span th:text="${task.status}"></span></p>
        </div>

        <div th:if="${message}" class="alert alert-success" th:text="${message}"></div>
        <div th:if="${error}" class="alert alert-error" th:text="${error}"></div>

        <form th:action="@{/attachments/upload/{taskId}(taskId=${task.id})}" method="post" enctype="multipart/form-data">
            <div class="form-group">
                <label for="file">Select File to Upload:</label>
                <div class="file-input-wrapper">
                    <input type="file" id="file" name="file" required onchange="updateFileName(this)">
                    <label for="file" class="file-input-label">
                        <span id="file-label-text">üìÇ Click to browse or drag and drop</span>
                    </label>
                </div>
                <div id="file-name" class="file-name"></div>
                <div class="file-requirements">
                    <strong>File Requirements:</strong>
                    <ul style="margin: 8px 0 0 20px; padding: 0;">
                        <li>Maximum file size: 50MB</li>
                        <li>Supported formats: PDF, DOC, DOCX, XLS, XLSX, PPT, PPTX, TXT, JPG, PNG, ZIP</li>
                    </ul>
                </div>
            </div>

            <div class="button-group">
                <button type="submit" class="btn btn-primary">Upload File</button>
                <a href="/tasks" class="btn btn-secondary" style="text-decoration: none; text-align: center;">Cancel</a>
            </div>
        </form>
    </div>

    <script>
        function updateFileName(input) {
            const fileNameDiv = document.getElementById('file-name');
            const labelText = document.getElementById('file-label-text');
            
            if (input.files && input.files[0]) {
                const file = input.files[0];
                fileNameDiv.textContent = '‚úì Selected: ' + file.name + ' (' + formatFileSize(file.size) + ')';
                labelText.textContent = '‚úì File selected: ' + file.name;
            }
        }

        function formatFileSize(bytes) {
            if (bytes === 0) return '0 Bytes';
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return Math.round(bytes / Math.pow(k, i) * 100) / 100 + ' ' + sizes[i];
        }

        // Drag and drop support
        const fileInput = document.getElementById('file');
        const dropZone = document.querySelector('.file-input-label');

        ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
            dropZone.addEventListener(eventName, preventDefaults, false);
        });

        function preventDefaults(e) {
            e.preventDefault();
            e.stopPropagation();
        }

        ['dragenter', 'dragover'].forEach(eventName => {
            dropZone.addEventListener(eventName, highlight, false);
        });

        ['dragleave', 'drop'].forEach(eventName => {
            dropZone.addEventListener(eventName, unhighlight, false);
        });

        function highlight(e) {
            dropZone.style.background = '#e7f1ff';
        }

        function unhighlight(e) {
            dropZone.style.background = '#f8f9fa';
        }

        dropZone.addEventListener('drop', handleDrop, false);

        function handleDrop(e) {
            const dt = e.dataTransfer;
            const files = dt.files;
            fileInput.files = files;
            updateFileName(fileInput);
        }
    </script>
</body>
</html>
